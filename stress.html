<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>äº²çˆ±çš„å°ç‹®å­ï¼Œæ¬¢è¿å›å®¶</title>
    <!-- ä½¿ç”¨å›½å†…æé€Ÿé™æ€èµ„æºé•œåƒ -->
    <link rel="stylesheet" href="https://cdn.staticfile.org/tailwindcss/2.2.19/tailwind.min.css">
    <script src="https://cdn.staticfile.org/lucide/0.263.0/lucide.min.js"></script>
    <style>
        /* æ ¸å¿ƒå¸ƒå±€ä¿åº•æ ·å¼ */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: #eff6ff;
            font-family: -apple-system, system-ui, "Microsoft YaHei", sans-serif;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: none; /* é˜²æ­¢é¡µé¢æ‹–åŠ¨ */
        }
        #app {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            opacity: 0;
            transition: opacity 0.5s ease-in;
        }

        /* åŠ¨ç”»å®šä¹‰ */
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(-1deg); }
            50% { transform: translateY(-12px) rotate(1deg); }
        }
        .animate-float { animation: float 3.5s ease-in-out infinite; }

        /* åˆ‡å¼€æ•ˆæœï¼šé—ªå…‰è½¨è¿¹ */
        .slash-effect {
            position: absolute;
            height: 3px;
            background: white;
            box-shadow: 0 0 8px white;
            transform-origin: left center;
            pointer-events: none;
            z-index: 100;
            animation: slash-fade 0.25s forwards;
        }
        @keyframes slash-fade {
            0% { width: 0; opacity: 1; }
            100% { width: 120px; opacity: 0; }
        }

        /* æ€ªç‰©è¢«åˆ‡ç¢æ—¶çš„åŠ¨ç”» */
        .monster-cut {
            animation: cut-apart 0.4s ease-out forwards;
        }
        @keyframes cut-apart {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.8) rotate(20deg); opacity: 0; filter: brightness(300%) blur(5px); }
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* å‹åŠ›æºç‰¹æ•ˆï¼šè´Ÿèƒ½é‡æ°”åœº */
        .monster-vibe {
            box-shadow: 0 0 15px rgba(0,0,0,0.4);
            border: 2px solid rgba(255,255,255,0.15);
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2), transparent);
            transition: transform 0.1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* æ–‡å­—å®¹å™¨é™åˆ¶ï¼Œé˜²æ­¢è¶…å‡ºå±å¹• */
        .label-container {
            max-width: 80px;
            word-wrap: break-word;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="app">
        <div style="display:flex; align-items:center; justify-content:center; height:100vh;">
            <p style="color:#60a5fa;">æ­£åœ¨è¿›å…¥ä½ çš„ä¸“å±è§£å‹ç©ºé—´...</p>
        </div>
    </div>

    <script>
        // éŸ³æ•ˆç³»ç»Ÿ (ä½¿ç”¨ Base64 æ•°æ®æˆ–ç®€å•çš„ Web Audio API ç”Ÿæˆ)
        const AudioCtx = window.AudioContext || window.webkitAudioContext;
        let ctx;

        function playSound(type) {
            if (!ctx) ctx = new AudioCtx();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);

            if (type === 'hit') {
                osc.type = 'square';
                osc.frequency.setValueAtTime(150, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(40, ctx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.2, ctx.currentTime);
                gain.gain.linearRampToValueAtTime(0, ctx.currentTime + 0.1);
                osc.start();
                osc.stop(ctx.currentTime + 0.1);
            } else if (type === 'break') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(300, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(10, ctx.currentTime + 0.3);
                gain.gain.setValueAtTime(0.3, ctx.currentTime);
                gain.gain.linearRampToValueAtTime(0, ctx.currentTime + 0.3);
                osc.start();
                osc.stop(ctx.currentTime + 0.3);
            } else if (type === 'btn') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(800, ctx.currentTime);
                gain.gain.setValueAtTime(0.1, ctx.currentTime);
                gain.gain.linearRampToValueAtTime(0, ctx.currentTime + 0.1);
                osc.start();
                osc.stop(ctx.currentTime + 0.1);
            }
        }

        const state = {
            mode: 'welcome',
            score: 0,
            monsters: [],
        };

        const MONSTER_TYPES = [
            { id: 'infinite', text: "è¯¥æ­»çš„æ²¡å®Œæ²¡äº†", emoji: "ğŸŒ€", color: "from-gray-800 to-black", hp: 3 },
            { id: 'family', text: "è¯¥æ­»çš„æ— ç†å®¶å±", emoji: "ğŸ‘¹", color: "from-red-600 to-red-900", hp: 3 },
            { id: 'paperwork', text: "è¯¥æ­»çš„ç—…å†", emoji: "ğŸ“", color: "from-blue-700 to-indigo-900", hp: 3 },
            { id: 'night', text: "è¯¥æ­»çš„å¤œç­", emoji: "ğŸ¦‡", color: "from-purple-800 to-black", hp: 3 },
            { id: 'hungry', text: "è¯¥æ­»çš„åŒäº‹", emoji: "ğŸ§Ÿ", color: "from-green-700 to-green-950", hp: 3 },
            { id: 'leader', text: "è¯¥æ­»çš„é¢†å¯¼åºŸè¯", emoji: "ğŸ¦†", color: "from-yellow-600 to-yellow-900", hp: 3 }
        ];

        function render() {
            const app = document.getElementById('app');
            let content = '';
            
            if (state.mode === 'welcome') {
                content = `
                    <div class="flex flex-col items-center justify-center h-screen p-4 text-center">
                        <div class="bg-white p-6 md:p-8 rounded-3xl shadow-2xl max-w-xs w-full border-t-8 border-blue-500">
                            <i data-lucide="heart-pulse" class="w-12 h-12 text-blue-500 mx-auto mb-4"></i>
                            <h1 class="text-xl font-bold mb-2 text-gray-800">äº²çˆ±çš„å°ç‹®å­ï¼Œè¾›è‹¦äº†</h1>
                            <p class="text-gray-400 text-sm mb-6 italic">â€œè¿™é‡Œæ²¡æœ‰çƒ¦æ¼ï¼Œåªæœ‰åˆ‡å‰²çš„å¿«ä¹ã€‚â€</p>
                            <button onclick="changeMode('vent')" class="w-full bg-blue-500 text-white py-3 rounded-full text-md font-bold shadow-lg active:scale-95 transition-transform">
                                å¼€å¯â€œåˆ‡ç¢çƒ¦æ¼â€æ¨¡å¼
                            </button>
                        </div>
                    </div>
                `;
            } else if (state.mode === 'vent') {
                content = `
                    <div class="h-screen bg-black text-white flex flex-col relative overflow-hidden" 
                         onmousemove="handleSlash(event)" ontouchmove="handleSlash(event)">
                        <div class="flex justify-between items-center p-4 bg-gray-900 border-b border-gray-800 z-50">
                            <div class="font-bold text-yellow-500 flex items-center tracking-tighter text-sm">
                                <i data-lucide="sword" class="w-4 h-4 mr-1"></i> æ–©æ–­: ${state.score}
                            </div>
                            <button onclick="changeMode('calm')" class="bg-green-600 px-3 py-1 rounded-full text-[10px] font-bold shadow-md">æ¶ˆæ°”äº† &rarr;</button>
                        </div>
                        
                        <div id="arena" class="flex-1 relative overflow-hidden">
                            ${state.monsters.length === 0 ? '<div class="absolute inset-0 flex flex-col items-center justify-center text-gray-700 text-center px-10 italic"><p class="text-3xl mb-2">ğŸ‘‹</p><p class="text-sm">é€‰ä¸‹é¢çš„æºå¤´,åˆ‡ç¢å®ƒä»¬ï¼</p></div>' : ''}
                            ${state.monsters.map(m => `
                                <div id="m-${m.instanceId}" class="absolute animate-float" 
                                     style="left: ${m.x}%; top: ${m.y}%; transform-origin: center;">
                                    <div class="w-20 h-20 rounded-full bg-gradient-to-br ${m.color} monster-vibe flex items-center justify-center text-3xl relative">
                                        <div class="absolute -top-1 -right-1 text-red-500 text-lg font-black">ğŸ’¢</div>
                                        <span class="z-10">${m.emoji}</span>
                                        <!-- è¡€æ¡/è€ä¹…åº¦ -->
                                        <div class="absolute -top-3 left-1/2 -translate-x-1/2 w-10 h-1 bg-gray-800 rounded-full overflow-hidden">
                                            <div class="h-full bg-red-500 transition-all" style="width: ${(m.hp/3)*100}%"></div>
                                        </div>
                                        <div class="absolute -bottom-8 left-1/2 -translate-x-1/2 bg-red-900/80 text-white text-[9px] px-2 py-0.5 rounded border border-red-500/30 whitespace-nowrap shadow-lg">
                                            ${m.text}
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>

                        <div class="bg-gray-950 p-3 pb-8 z-50">
                            <div class="text-[8px] text-gray-500 mb-2 uppercase tracking-[0.2em] font-black text-center">å¬å”¤åŒæ¶ä¹‹æº</div>
                            <div class="flex gap-2 overflow-x-auto no-scrollbar pb-2 px-2">
                                ${MONSTER_TYPES.map(t => `
                                    <button onclick="spawnMonster('${t.id}')" class="flex-shrink-0 w-16 h-20 bg-gray-900 rounded-xl flex flex-col items-center justify-center border-2 border-gray-800 active:border-red-600 active:scale-95 transition-all">
                                        <span class="text-2xl">${t.emoji}</span>
                                        <span class="text-[8px] mt-1 font-bold text-gray-500">${t.text}</span>
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            } else if (state.mode === 'calm') {
                content = `
                    <div class="h-screen bg-green-50 flex flex-col items-center justify-center p-6 text-center">
                        <h2 class="text-xl font-bold text-green-800 mb-8">æ·±å‘¼å¸...éƒ½ç¢æ‰äº†</h2>
                        <div id="breath-circle" class="w-40 h-40 bg-green-200 rounded-full flex items-center justify-center shadow-inner transition-all duration-[4000ms] border-4 border-green-100">
                            <span id="breath-text" class="text-lg font-bold text-green-800">å¸æ°”...</span>
                        </div>
                        <button onclick="changeMode('love')" class="mt-12 bg-white text-green-600 px-8 py-3 rounded-full font-bold shadow-md border border-green-200 active:scale-95">
                            ç»§ç»­ &rarr;
                        </button>
                    </div>
                `;
                startBreathing();
            } else if (state.mode === 'love') {
                content = `
                    <div class="h-screen bg-pink-50 flex flex-col items-center justify-center p-6">
                        <div class="bg-white p-8 rounded-[2rem] shadow-2xl max-w-xs w-full text-center relative border border-pink-100">
                            <div class="absolute -top-8 left-1/2 transform -translate-x-1/2 bg-red-500 text-white p-3 rounded-full shadow-lg">
                                <i data-lucide="heart" class="w-6 h-6 fill-current"></i>
                            </div>
                            <h2 class="text-xl font-bold mb-4 mt-2 text-gray-800">æœ€æ£’çš„å°ç‹®å­ï¼Œè¾›è‹¦äº†</h2>
                            <p class="text-sm text-gray-500 mb-6 font-medium">æ‰€æœ‰çš„çƒ¦æ¼éƒ½è¢«ä½ äº²æ‰‹æ–©æ–­ï¼ç°åœ¨ï¼Œè¯·æ¥å—è¿™ä¸ªç‰¹åˆ«çš„ç¤¼ç‰©ã€‚</p>
                            <div class="space-y-3">
                                <button onclick="handleClaim()" class="w-full bg-gradient-to-r from-red-500 to-pink-500 text-white py-3 rounded-xl font-bold shadow-lg active:scale-95">
                                    é¢†å–ã€Œè¶…å¤§å·æ‹¥æŠ±ã€
                                </button>
                                <button onclick="changeMode('welcome')" class="w-full bg-gray-100 text-gray-500 py-3 rounded-xl font-bold active:scale-95 text-xs">
                                    å†æ¥ä¸€æ¬¡
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }

            app.innerHTML = content;
            app.style.opacity = 1;
            if (typeof lucide !== 'undefined') lucide.createIcons();
        }

        function handleSlash(e) {
            if (state.mode !== 'vent') return;
            const clientX = e.clientX || (e.touches && e.touches[0].clientX);
            const clientY = e.clientY || (e.touches && e.touches[0].clientY);
            if (!clientX || !clientY) return;

            createSlashGraphic(clientX, clientY);

            state.monsters.forEach(m => {
                const el = document.getElementById(`m-${m.instanceId}`);
                if (!el || el.classList.contains('monster-cut')) return;
                const rect = el.getBoundingClientRect();
                const mx = rect.left + rect.width / 2;
                const my = rect.top + rect.height / 2;
                const dist = Math.sqrt(Math.pow(clientX - mx, 2) + Math.pow(clientY - my, 2));
                
                if (dist < 55) {
                    hitMonster(m.instanceId);
                }
            });
        }

        function createSlashGraphic(x, y) {
            const arena = document.getElementById('arena');
            if (!arena) return;
            const slash = document.createElement('div');
            slash.className = 'slash-effect';
            slash.style.left = x + 'px';
            slash.style.top = y + 'px';
            slash.style.transform = `rotate(${Math.random() * 360}deg)`;
            arena.appendChild(slash);
            setTimeout(() => slash.remove(), 250);
        }

        function changeMode(m) {
            playSound('btn');
            if (breathTimer) clearInterval(breathTimer);
            const app = document.getElementById('app');
            app.style.opacity = 0;
            setTimeout(() => {
                state.mode = m;
                if(m === 'welcome') {
                    state.score = 0;
                    state.monsters = [];
                }
                render();
            }, 300);
        }

        function spawnMonster(typeId) {
            playSound('btn');
            const type = MONSTER_TYPES.find(t => t.id === typeId);
            // ç¡®ä¿ç”Ÿæˆä½ç½®ä¸è¶…å‡ºå±å¹•è¾¹ç¼˜
            const monster = {
                ...type,
                instanceId: Date.now() + Math.random(),
                x: 10 + Math.random() * 60,
                y: 10 + Math.random() * 60,
                hp: 3
            };
            state.monsters.push(monster);
            render();
            if(window.navigator.vibrate) window.navigator.vibrate(10);
        }

        function hitMonster(id) {
            const m = state.monsters.find(item => item.instanceId === id);
            if (!m) return;
            
            const el = document.getElementById(`m-${id}`);
            if (!el) return;

            m.hp -= 1;
            playSound('hit');
            
            // è¢«å‡»ä¸­æ—¶çš„ç¼©æ”¾åé¦ˆ
            el.style.transform = 'scale(0.8)';
            setTimeout(() => { if(el) el.style.transform = 'scale(1)'; }, 100);

            if (m.hp <= 0) {
                el.classList.add('monster-cut');
                state.score += 30;
                playSound('break');
                if(window.navigator.vibrate) window.navigator.vibrate(60);
                setTimeout(() => {
                    state.monsters = state.monsters.filter(item => item.instanceId !== id);
                    render();
                }, 400);
            } else {
                // æ›´æ–°å±€éƒ¨è¡€æ¡ UI
                const bar = el.querySelector('.bg-red-500');
                if(bar) bar.style.width = `${(m.hp/3)*100}%`;
            }
        }

        let breathTimer;
        function startBreathing() {
            let step = 0;
            const update = () => {
                const circle = document.getElementById('breath-circle');
                const text = document.getElementById('breath-text');
                if(!circle || !text) return;
                if (step % 2 === 0) {
                    circle.style.transform = 'scale(1.3)';
                    text.innerText = 'å¸æ°”...';
                } else {
                    circle.style.transform = 'scale(1)';
                    text.innerText = 'å‘¼æ°”...';
                }
                step++;
            };
            setTimeout(update, 100);
            breathTimer = setInterval(update, 4000);
        }

        function handleClaim() {
            playSound('btn');
            const overlay = document.createElement('div');
            overlay.className = "fixed inset-0 bg-black/80 backdrop-blur-md flex items-center justify-center z-[100] p-6 text-center";
            overlay.innerHTML = `
                <div class="bg-white rounded-3xl p-8 shadow-2xl max-w-xs scale-in">
                    <div class="text-5xl mb-4 animate-bounce">ğŸ§§</div>
                    <h3 class="text-lg font-bold mb-2 text-gray-800">å…‘æ¢æˆåŠŸï¼</h3>
                    <p class="text-gray-400 text-xs mb-6">æ­¤åˆ¸é•¿æœŸæœ‰æ•ˆï¼šå‡­æ­¤é¡µå¯éšæ—¶å‘èº«è¾¹çš„æŸæŸäººç´¢è¦è¶…çº§å¤§çš„æ‹¥æŠ±ä¸€ä¸ªï¼</p>
                    <button onclick="this.parentElement.parentElement.remove()" class="bg-red-500 text-white px-8 py-2 rounded-full font-bold shadow-lg">å¥½å“’</button>
                </div>
            `;
            document.body.appendChild(overlay);
        }

        window.onload = render;
    </script>
</body>
</html>
