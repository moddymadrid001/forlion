<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åŒ»æŠ¤å‡å‹åˆ‡åˆ‡ä¹ - çœŸå®åˆ‡å‰²æ•ˆæœ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Sans+SC:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: linear-gradient(135deg, #0c2461 0%, #1e3799 100%);
            color: #fff;
            min-height: 100vh;
            overflow: hidden;
            touch-action: none;
        }
        
        .container {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        /* æ¸¸æˆæ ‡é¢˜åŒºåŸŸ - ç§»åŠ¨ç«¯ä¼˜åŒ– */
        .game-header {
            padding: 10px 15px;
            background: rgba(0, 0, 0, 0.4);
            text-align: center;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            z-index: 10;
            backdrop-filter: blur(10px);
            min-height: 70px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        h1 {
            font-family: 'Ma Shan Zheng', cursive;
            font-size: 1.8rem;
            margin-bottom: 5px;
            color: #feca57;
            text-shadow: 0 3px 8px rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .heartbeat {
            animation: heartbeat 1.5s infinite;
            color: #ff6b8b;
        }
        
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15); }
        }
        
        .subtitle {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.85);
            margin-bottom: 5px;
            font-weight: 300;
        }
        
        /* æ¸¸æˆä¿¡æ¯é¢æ¿ - ç§»åŠ¨ç«¯ä¼˜åŒ– */
        .game-info {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px;
            background: rgba(0, 0, 0, 0.5);
            padding: 8px 10px;
            border-radius: 10px;
            margin: 0 auto;
            width: 95%;
            max-width: 700px;
            border: 1px solid rgba(254, 202, 87, 0.3);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
        }
        
        .info-item {
            text-align: center;
            padding: 2px;
        }
        
        .info-label {
            font-size: 0.7rem;
            color: #a29bfe;
            margin-bottom: 2px;
            font-weight: 500;
        }
        
        .info-value {
            font-size: 1.3rem;
            font-weight: 900;
            color: #feca57;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.7);
        }
        
        /* æ¸¸æˆåŒºåŸŸ */
        .game-area {
            flex: 1;
            position: relative;
            overflow: hidden;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 40 40"><circle cx="20" cy="20" r="16" fill="%23feca57" opacity="0.8"/><circle cx="20" cy="20" r="6" fill="%23ff6b8b"/><path d="M20,5 L20,35 M5,20 L35,20" stroke="%23ffffff" stroke-width="2" opacity="0.7"/></svg>') 20 20, auto;
        }
        
        /* æ¸¸æˆç‰©å“ - ç§»åŠ¨ç«¯ä¼˜åŒ– */
        .game-item {
            position: absolute;
            cursor: pointer;
            user-select: none;
            z-index: 5;
            filter: drop-shadow(0 8px 15px rgba(0, 0, 0, 0.4));
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid rgba(255, 255, 255, 0.9);
            box-sizing: border-box;
            transition: transform 0.1s;
            will-change: transform;
        }
        
        /* å›¾æ ‡å®¹å™¨ */
        .item-icon {
            width: 70px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 6px;
            font-size: 3.2rem;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.5);
            transition: transform 0.2s;
        }
        
        .item-label {
            font-size: 1rem;
            font-weight: 700;
            color: white;
            text-shadow: 1px 1px 5px rgba(0, 0, 0, 0.7);
            padding: 3px 8px;
            border-radius: 15px;
            background: rgba(0, 0, 0, 0.4);
            max-width: 110px;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* åˆ‡å‰²åçš„ä¸¤åŠæ•ˆæœ */
        .item-half {
            position: absolute;
            width: 120px;
            height: 120px;
            overflow: hidden;
            z-index: 6;
            filter: drop-shadow(0 8px 15px rgba(0, 0, 0, 0.4));
            border: 3px solid rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        
        .half-left {
            clip-path: polygon(0 0, 50% 0, 50% 100%, 0 100%);
        }
        
        .half-right {
            clip-path: polygon(50% 0, 100% 0, 100% 100%, 50% 100%);
        }
        
        .half-content {
            position: absolute;
            width: 240px;
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .half-emoji {
            font-size: 3.2rem;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.5);
        }
        
        .half-label {
            font-size: 1rem;
            font-weight: 700;
            color: white;
            text-shadow: 1px 1px 5px rgba(0, 0, 0, 0.7);
            position: absolute;
            bottom: 12px;
            padding: 3px 8px;
            border-radius: 15px;
            background: rgba(0, 0, 0, 0.4);
            white-space: nowrap;
        }
        
        /* åˆ‡å‰²è½¨è¿¹æ•ˆæœ */
        .trail {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(254, 202, 87, 0.9) 0%, rgba(255, 107, 139, 0.7) 100%);
            pointer-events: none;
            z-index: 100;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 8px rgba(254, 202, 87, 0.8);
        }
        
        /* åˆ‡å‰²çº¿æ•ˆæœ */
        .cut-line {
            position: absolute;
            height: 3px;
            background: linear-gradient(90deg, transparent, #feca57, #ff6b8b, #feca57, transparent);
            border-radius: 2px;
            pointer-events: none;
            z-index: 99;
            transform-origin: left center;
            box-shadow: 0 0 10px rgba(254, 202, 87, 0.9);
        }
        
        /* æœæ±å–·æº…æ•ˆæœ */
        .juice-particle {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 7;
        }
        
        /* åˆ†æ•°å¢åŠ åŠ¨ç”» */
        .score-popup {
            position: absolute;
            color: #feca57;
            font-size: 1.8rem;
            font-weight: 900;
            text-shadow: 0 3px 8px rgba(0, 0, 0, 0.8);
            pointer-events: none;
            z-index: 95;
            animation: scorePopup 1.2s forwards;
        }
        
        @keyframes scorePopup {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-70px) scale(1.5); opacity: 0; }
        }
        
        /* è¿å‡»æ•ˆæœ - ç§»åŠ¨åˆ°å³ä¸Šè§’ */
        .combo-display {
            position: absolute;
            top: 15px;
            right: 15px;
            background: linear-gradient(135deg, rgba(255, 107, 139, 0.9), rgba(254, 202, 87, 0.9));
            padding: 8px 15px;
            border-radius: 30px;
            border: 2px solid white;
            color: white;
            font-size: 1.4rem;
            font-weight: 900;
            text-align: center;
            z-index: 90;
            opacity: 0;
            transition: opacity 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
            display: none; /* åˆå§‹éšè—ï¼Œåªåœ¨è¿å‡»æ—¶æ˜¾ç¤º */
        }
        
        .combo-display.active {
            opacity: 1;
            display: block;
        }
        
        /* æ¸¸æˆæ§åˆ¶åŒºåŸŸ - ç§»åŠ¨ç«¯ä¼˜åŒ–ä¸ºå¯æŠ˜å èœå• */
        .game-controls {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.7);
            border-top: 2px solid rgba(255, 255, 255, 0.1);
            z-index: 100;
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease;
            padding: 10px;
            box-sizing: border-box;
        }
        
        .controls-collapsed .game-controls {
            transform: translateY(calc(100% - 50px));
        }
        
        .controls-toggle {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 30px;
            background: linear-gradient(135deg, #ff6b8b, #ff4757);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-bottom: none;
            border-radius: 15px 15px 0 0;
            color: white;
            font-size: 0.9rem;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 101;
            box-shadow: 0 -3px 10px rgba(0, 0, 0, 0.3);
        }
        
        .controls-toggle i {
            transition: transform 0.3s;
        }
        
        .controls-collapsed .controls-toggle i {
            transform: rotate(180deg);
        }
        
        .buttons-container {
            display: flex;
            justify-content: space-between;
            gap: 8px;
            padding-top: 5px;
        }
        
        .btn {
            padding: 12px 15px;
            background: linear-gradient(135deg, #ff6b8b, #ff4757);
            color: white;
            border: none;
            border-radius: 40px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(255, 107, 139, 0.5);
            border: 2px solid rgba(255, 255, 255, 0.3);
            flex: 1;
            min-height: 50px;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 18px rgba(255, 107, 139, 0.7);
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        .btn-start {
            background: linear-gradient(135deg, #2ed573, #1dd1a1);
            box-shadow: 0 4px 12px rgba(46, 213, 115, 0.5);
        }
        
        .btn-pause {
            background: linear-gradient(135deg, #ffa502, #ff9f1a);
            box-shadow: 0 4px 12px rgba(255, 165, 2, 0.5);
        }
        
        .btn-reset {
            background: linear-gradient(135deg, #3742fa, #5352ed);
            box-shadow: 0 4px 12px rgba(55, 66, 250, 0.5);
        }
        
        /* æ¸¸æˆç»“æŸå¼¹çª— - ç§»åŠ¨ç«¯ä¼˜åŒ– */
        .game-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s;
        }
        
        .game-overlay.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .game-modal {
            background: linear-gradient(135deg, #1e3799, #0c2461);
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.7);
            transform: scale(0.8);
            transition: transform 0.5s;
            border: 3px solid #feca57;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .game-overlay.active .game-modal {
            transform: scale(1);
        }
        
        .modal-title {
            font-size: 2.2rem;
            color: #feca57;
            margin-bottom: 20px;
            font-family: 'Ma Shan Zheng', cursive;
            text-shadow: 0 3px 8px rgba(0, 0, 0, 0.7);
        }
        
        .modal-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .stat-box {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            border: 2px solid rgba(254, 202, 87, 0.4);
            backdrop-filter: blur(10px);
        }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: 900;
            color: #feca57;
            margin-bottom: 5px;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.7);
        }
        
        .stat-label {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
        }
        
        /* æ¸¸æˆè¯´æ˜ - ç§»åŠ¨ç«¯éšè— */
        .instructions {
            display: none;
        }
        
        /* èƒŒæ™¯è£…é¥° */
        .bg-decoration {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
        }
        
        .bg-element {
            position: absolute;
            font-size: 2rem;
            opacity: 0.1;
            animation: float 25s infinite linear;
        }
        
        @keyframes float {
            0% { transform: translateY(100vh) rotate(0deg); }
            100% { transform: translateY(-100px) rotate(360deg); }
        }
        
        /* éš¾åº¦æŒ‡ç¤ºå™¨ - ç§»åŠ¨åˆ°å·¦ä¸Šè§’ */
        .difficulty {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(0, 0, 0, 0.6);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            color: #feca57;
            z-index: 10;
            border: 1px solid rgba(254, 202, 87, 0.3);
            font-weight: 600;
        }
        
        /* è¿›åº¦æ¡ */
        .time-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            z-index: 10;
        }
        
        .time-bar {
            height: 100%;
            background: linear-gradient(90deg, #2ed573, #feca57, #ff6b8b);
            width: 100%;
            transition: width 1s linear;
        }
        
        /* æ¸¸æˆå¼€å§‹å€’è®¡æ—¶ */
        .countdown {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            font-size: 8rem;
            color: #feca57;
            font-weight: 900;
            text-shadow: 0 5px 20px rgba(254, 202, 87, 0.8);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        
        .countdown.active {
            opacity: 1;
        }
        
        /* ç§»åŠ¨ç«¯å…¨å±æ¸¸æˆåŒºåŸŸæç¤º */
        .mobile-hint {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            z-index: 20;
            max-width: 90%;
            backdrop-filter: blur(10px);
            border: 2px solid #feca57;
            display: none;
        }
        
        .mobile-hint.show {
            display: block;
        }
        
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 768px) {
            h1 {
                font-size: 1.5rem;
            }
            
            .subtitle {
                font-size: 0.8rem;
            }
            
            .game-info {
                padding: 6px 8px;
                width: 98%;
                gap: 5px;
            }
            
            .info-value {
                font-size: 1.1rem;
            }
            
            .info-label {
                font-size: 0.65rem;
            }
            
            .game-item, .item-half {
                width: 100px;
                height: 100px;
            }
            
            .item-icon, .half-emoji {
                font-size: 2.8rem;
            }
            
            .item-label, .half-label {
                font-size: 0.9rem;
                max-width: 90px;
            }
            
            .btn {
                padding: 10px 12px;
                font-size: 0.9rem;
                min-height: 45px;
            }
            
            .btn i {
                font-size: 1.1rem;
            }
            
            .modal-title {
                font-size: 1.8rem;
            }
            
            .stat-value {
                font-size: 1.8rem;
            }
            
            .stat-label {
                font-size: 0.9rem;
            }
            
            .combo-display {
                font-size: 1.2rem;
                padding: 6px 12px;
                top: 10px;
                right: 10px;
            }
            
            .difficulty {
                top: 10px;
                left: 10px;
                font-size: 0.75rem;
                padding: 5px 10px;
            }
            
            .countdown {
                font-size: 6rem;
            }
        }
        
        @media (max-width: 480px) {
            .game-info {
                grid-template-columns: repeat(2, 2fr);
                gap: 10px;
            }
            
            .buttons-container {
                flex-direction: column;
                gap: 8px;
            }
            
            .btn {
                width: 100%;
                max-width: none;
            }
            
            .modal-stats {
                grid-template-columns: 1fr;
            }
            
            .game-item, .item-half {
                width: 90px;
                height: 90px;
            }
            
            .item-icon, .half-emoji {
                font-size: 2.5rem;
            }
            
            .item-label, .half-label {
                font-size: 0.85rem;
                max-width: 85px;
            }
            
            .controls-toggle {
                width: 70px;
                height: 25px;
                font-size: 0.8rem;
                top: -35px;
            }
        }
        
        /* å°å±å¹•æ‰‹æœºç‰¹åˆ«è°ƒæ•´ */
        @media (max-width: 380px) and (max-height: 700px) {
            .game-header {
                padding: 8px 10px;
                min-height: 60px;
            }
            
            h1 {
                font-size: 1.3rem;
            }
            
            .game-info {
                padding: 5px 6px;
            }
            
            .info-value {
                font-size: 1rem;
            }
            
            .info-label {
                font-size: 0.6rem;
            }
            
            .game-item, .item-half {
                width: 85px;
                height: 85px;
            }
            
            .item-icon, .half-emoji {
                font-size: 2.2rem;
            }
        }
        
        /* æ¨ªå±ä¼˜åŒ– */
        @media (max-height: 500px) and (orientation: landscape) {
            .game-header {
                flex-direction: row;
                align-items: center;
                justify-content: space-between;
                padding: 5px 10px;
                min-height: 50px;
            }
            
            h1 {
                font-size: 1.3rem;
                margin-bottom: 0;
            }
            
            .subtitle {
                display: none;
            }
            
            .game-info {
                width: auto;
                max-width: 60%;
            }
            
            .game-controls {
                padding: 5px 10px;
            }
            
            .buttons-container {
                flex-direction: row;
            }
            
            .btn {
                padding: 8px 10px;
                font-size: 0.8rem;
                min-height: 40px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- æ¸¸æˆæ ‡é¢˜åŒºåŸŸ -->
        <header class="game-header">
            <h1><i class="fas fa-heartbeat heartbeat"></i> åŒ»æŠ¤å‡å‹åˆ‡åˆ‡ä¹ <i class="fas fa-heartbeat heartbeat"></i></h1>
            <p class="subtitle">å°†å·¥ä½œä¸­çš„å‹åŠ›ä¸€åˆ‡ä¸¤åŠï¼Œé‡Šæ”¾å¿ƒæƒ…ï¼Œè½»æ¾ä¸Šé˜µï¼</p>
            
            <div class="game-info">
                <div class="info-item">
                    <div class="info-label">å‡å‹åˆ†æ•°</div>
                    <div id="score" class="info-value">0</div>
                </div>
                <div class="info-item">
                    <div class="info-label">å‰©ä½™æ—¶é—´</div>
                    <div id="timer" class="info-value">30</div>
                </div>
                <div class="info-item">
                    <div class="info-label">è¿å‡»æ¬¡æ•°</div>
                    <div id="combo" class="info-value">0</div>
                </div>
                <div class="info-item">
                    <div class="info-label">åˆ‡å‰²æ•°é‡</div>
                    <div id="cuts" class="info-value">0</div>
                </div>
            </div>
        </header>
        
        <!-- æ¸¸æˆåŒºåŸŸ -->
        <div class="game-area" id="game-area">
            <!-- æ¸¸æˆç‰©å“ä¼šåŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
            <div class="combo-display" id="combo-display">è¿å‡» x<span id="combo-count">0</span></div>
            
            <!-- éš¾åº¦æŒ‡ç¤ºå™¨ -->
            <div class="difficulty" id="difficulty">éš¾åº¦: æ™®é€š</div>
            
            <!-- èƒŒæ™¯è£…é¥° -->
            <div class="bg-decoration" id="bg-decoration"></div>
        </div>
        
        <!-- æ—¶é—´è¿›åº¦æ¡ -->
        <div class="time-progress">
            <div class="time-bar" id="time-bar"></div>
        </div>
        
        <!-- æ¸¸æˆæ§åˆ¶åŒºåŸŸ -->
        <div class="game-controls">
            <div class="controls-toggle" id="controls-toggle">
                <i class="fas fa-chevron-up"></i>
            </div>
            <div class="buttons-container">
                <button id="start-btn" class="btn btn-start"><i class="fas fa-play-circle"></i> å¼€å§‹</button>
                <button id="pause-btn" class="btn btn-pause"><i class="fas fa-pause-circle"></i> æš‚åœ</button>
                <button id="reset-btn" class="btn btn-reset"><i class="fas fa-redo-alt"></i> é‡ç½®</button>
            </div>
        </div>
        
        <!-- ç§»åŠ¨ç«¯æç¤º -->
        <div class="mobile-hint" id="mobile-hint">
            <h3>æ¸¸æˆè¯´æ˜</h3>
            <p>ç”¨æ‰‹æŒ‡åœ¨å±å¹•ä¸Šæ»‘åŠ¨åˆ‡å‰²å‹åŠ›å›¾æ ‡</p>
            <p>å¿«é€Ÿè¿ç»­åˆ‡å‰²å¯è·å¾—è¿å‡»åŠ åˆ†</p>
            <p>æ¸¸æˆæ—¶é—´ï¼š30ç§’</p>
            <p>ä¸‹æ–¹æŒ‰é’®å¯æ§åˆ¶æ¸¸æˆ</p>
            <button id="close-hint" class="btn btn-start" style="margin-top: 15px; padding: 10px 20px;">
                å¼€å§‹æ¸¸æˆ
            </button>
        </div>
    </div>
    
    <!-- æ¸¸æˆå¼€å§‹å€’è®¡æ—¶ -->
    <div class="countdown" id="countdown">3</div>
    
    <!-- æ¸¸æˆç»“æŸå¼¹çª— -->
    <div class="game-overlay" id="game-overlay">
        <div class="game-modal">
            <h2 class="modal-title" id="game-result">å‡å‹å®Œæˆ!</h2>
            <div class="modal-stats">
                <div class="stat-box">
                    <div class="stat-value" id="final-score">0</div>
                    <div class="stat-label">å‡å‹åˆ†æ•°</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="final-cuts">0</div>
                    <div class="stat-label">åˆ‡å‰²æ•°é‡</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="final-combo">0</div>
                    <div class="stat-label">æœ€é«˜è¿å‡»</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="final-time">0s</div>
                    <div class="stat-label">å‰©ä½™æ—¶é—´</div>
                </div>
            </div>
            
            <div style="margin: 20px 0; color: rgba(255, 255, 255, 0.9); font-size: 1.1rem; line-height: 1.5;">
                <p>äº²çˆ±çš„ç™½è¡£å¤©ä½¿ï¼Œä½ å·²æˆåŠŸé‡Šæ”¾äº† <span style="color:#feca57; font-weight:bold;" id="stress-released">0</span> ä¸ªå‹åŠ›æºï¼</p>
                <p>æ„Ÿè°¢ä½ çš„è¾›å‹¤ä»˜å‡ºï¼Œè¯·è®°å¾—ç…§é¡¾å¥½è‡ªå·±çš„èº«å¿ƒå¥åº·ï¼</p>
            </div>
            
            <button id="play-again-btn" class="btn btn-start" style="font-size: 1.3rem; padding: 15px 30px; margin-top: 10px;">
                <i class="fas fa-redo-alt"></i> å†ç©ä¸€æ¬¡
            </button>
        </div>
    </div>
    
    <script>
        // æ¸¸æˆå˜é‡
        let gameScore = 0;
        let gameTime = 30;
        let totalTime = 30;
        let gameActive = false;
        let gameTimer = null;
        let itemSpawnTimer = null;
        let items = [];
        let cutCount = 0;
        let currentCombo = 0;
        let maxCombo = 0;
        let lastCutTime = 0;
        let comboTimeout = null;
        let difficulty = 1; // 1:æ™®é€š, 2:å›°éš¾
        let mouseX = 0;
        let mouseY = 0;
        let trails = [];
        let trailTimer = null;
        let cutLines = [];
        let cutLineTimer = null;
        let lastCutPoint = null;
        let isMobile = false;
        
        // DOMå…ƒç´ 
        const gameArea = document.getElementById('game-area');
        const scoreEl = document.getElementById('score');
        const timerEl = document.getElementById('timer');
        const comboEl = document.getElementById('combo');
        const cutsEl = document.getElementById('cuts');
        const startBtn = document.getElementById('start-btn');
        const pauseBtn = document.getElementById('pause-btn');
        const resetBtn = document.getElementById('reset-btn');
        const gameOverlay = document.getElementById('game-overlay');
        const finalScoreEl = document.getElementById('final-score');
        const finalCutsEl = document.getElementById('final-cuts');
        const finalComboEl = document.getElementById('final-combo');
        const finalTimeEl = document.getElementById('final-time');
        const stressReleasedEl = document.getElementById('stress-released');
        const playAgainBtn = document.getElementById('play-again-btn');
        const comboDisplay = document.getElementById('combo-display');
        const comboCountEl = document.getElementById('combo-count');
        const difficultyEl = document.getElementById('difficulty');
        const bgDecoration = document.getElementById('bg-decoration');
        const timeBar = document.getElementById('time-bar');
        const countdownEl = document.getElementById('countdown');
        const controlsToggle = document.getElementById('controls-toggle');
        const container = document.querySelector('.container');
        const mobileHint = document.getElementById('mobile-hint');
        const closeHintBtn = document.getElementById('close-hint');
        
        // æ£€æµ‹æ˜¯å¦ç§»åŠ¨è®¾å¤‡
        function detectMobile() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || 
                   (window.innerWidth <= 768);
        }
        
        // åˆå§‹åŒ–ç§»åŠ¨ç«¯è®¾ç½®
        function initMobileSettings() {
            isMobile = detectMobile();
            
            if (isMobile) {
                // æ·»åŠ ç§»åŠ¨ç«¯ç±»
                container.classList.add('controls-collapsed');
                
                // æ˜¾ç¤ºç§»åŠ¨ç«¯æç¤º
                mobileHint.classList.add('show');
                
                // è°ƒæ•´ç‰©å“å¤§å°
                adjustItemSizeForMobile();
            }
        }
        
        // æ ¹æ®å±å¹•å¤§å°è°ƒæ•´ç‰©å“å°ºå¯¸
        function adjustItemSizeForMobile() {
            // æ ¹æ®å±å¹•é«˜åº¦åŠ¨æ€è°ƒæ•´ç‰©å“å¤§å°
            const screenHeight = window.innerHeight;
            const screenWidth = window.innerWidth;
            
            // å¦‚æœæ˜¯æ¨ªå±ï¼Œä½¿ç”¨å®½åº¦ä½œä¸ºå‚è€ƒ
            const referenceSize = screenHeight < screenWidth ? screenWidth : screenHeight;
            
            // è®¡ç®—åˆé€‚çš„ç‰©å“å¤§å°
            let itemSize = 100;
            if (referenceSize < 700) {
                itemSize = 85;
            } else if (referenceSize < 900) {
                itemSize = 95;
            }
            
            // æˆ‘ä»¬å°†åœ¨ç”Ÿæˆç‰©å“æ—¶åŠ¨æ€è®¾ç½®ï¼Œè¿™é‡Œåªæ˜¯è®¾ç½®å‚è€ƒå€¼
            return itemSize;
        }
        
        // æ¸¸æˆç‰©å“æ•°æ® - ç¾è§‚å¤§å›¾æ ‡ + ä¸­æ–‡å‹åŠ›è¯
        const gameItems = [
            { 
                emoji: "ğŸ˜ ", 
                name: "æ„¤æ€’æ‚£è€…", 
                score: 100, 
                bgColor: "radial-gradient(circle, #ff6b8b, #ff4757)",
                borderColor: "#ff6b8b",
                juiceColor: "#ff6b8b",
                speed: 2.5
            },
            { 
                emoji: "ğŸ˜«", 
                name: "åŠ ç­ç–²æƒ«", 
                score: 150, 
                bgColor: "radial-gradient(circle, #74b9ff, #0984e3)",
                borderColor: "#74b9ff",
                juiceColor: "#74b9ff",
                speed: 2.2
            },
            { 
                emoji: "ğŸ“‹", 
                name: "ç—…å†å †ç§¯", 
                score: 120, 
                bgColor: "radial-gradient(circle, #6c5ce7, #4834d4)",
                borderColor: "#6c5ce7",
                juiceColor: "#6c5ce7",
                speed: 1.8
            },
            { 
                emoji: "ğŸ’‰", 
                name: "æ‰“é’ˆå‹åŠ›", 
                score: 180, 
                bgColor: "radial-gradient(circle, #00b894, #00a085)",
                borderColor: "#00b894",
                juiceColor: "#00b894",
                speed: 3.0
            },
            { 
                emoji: "ğŸŒ™", 
                name: "å¤œç­è¾›è‹¦", 
                score: 200, 
                bgColor: "radial-gradient(circle, #fdcb6e, #f9ca24)",
                borderColor: "#fdcb6e",
                juiceColor: "#fdcb6e",
                speed: 2.5
            },
            { 
                emoji: "âš–ï¸", 
                name: "åŒ»æ‚£çº çº·", 
                score: 250, 
                bgColor: "radial-gradient(circle, #e17055, #d63031)",
                borderColor: "#e17055",
                juiceColor: "#e17055",
                speed: 3.2
            },
            { 
                emoji: "ğŸ˜”", 
                name: "å§”å±ˆæƒ…ç»ª", 
                score: 130, 
                bgColor: "radial-gradient(circle, #a29bfe, #6c5ce7)",
                borderColor: "#a29bfe",
                juiceColor: "#a29bfe",
                speed: 2.0
            },
            { 
                emoji: "â°", 
                name: "æ—¶é—´ç´§è¿«", 
                score: 160, 
                bgColor: "radial-gradient(circle, #fd79a8, #e84393)",
                borderColor: "#fd79a8",
                juiceColor: "#fd79a8",
                speed: 3.5
            },
            { 
                emoji: "ğŸƒ", 
                name: "å¿™ç¢Œå¥”æ³¢", 
                score: 140, 
                bgColor: "radial-gradient(circle, #55efc4, #00b894)",
                borderColor: "#55efc4",
                juiceColor: "#55efc4",
                speed: 3.8
            },
            { 
                emoji: "ğŸ’Š", 
                name: "è¯ç‰©ç®¡ç†", 
                score: 110, 
                bgColor: "radial-gradient(circle, #ffeaa7, #fdcb6e)",
                borderColor: "#ffeaa7",
                juiceColor: "#ffeaa7",
                speed: 2.7
            }
        ];
        
        // èƒŒæ™¯è£…é¥°å…ƒç´ 
        const bgEmojis = ["âš•ï¸", "ğŸ¥", "ğŸ’—", "â¤ï¸", "ğŸ©º", "ğŸŒ¡ï¸", "ğŸ©¹", "ğŸ’‰", "ğŸ‘¨â€âš•ï¸", "ğŸ‘©â€âš•ï¸"];
        
        // åˆ›å»ºèƒŒæ™¯è£…é¥°å…ƒç´ 
        function createBackgroundElements() {
            bgDecoration.innerHTML = '';
            for (let i = 0; i < 20; i++) {
                const element = document.createElement('div');
                element.className = 'bg-element';
                element.textContent = bgEmojis[Math.floor(Math.random() * bgEmojis.length)];
                element.style.left = `${Math.random() * 100}%`;
                element.style.animationDelay = `${Math.random() * 20}s`;
                element.style.fontSize = `${Math.random() * 20 + 15}px`;
                element.style.color = `rgba(255, 255, 255, ${Math.random() * 0.1 + 0.05})`;
                bgDecoration.appendChild(element);
            }
        }
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            gameScore = 0;
            gameTime = 30;
            totalTime = 30;
            cutCount = 0;
            currentCombo = 0;
            maxCombo = 0;
            difficulty = 1;
            lastCutPoint = null;
            
            // æ¸…ç©ºç‰©å“
            items.forEach(item => {
                if (item.element && item.element.parentNode) {
                    item.element.parentNode.removeChild(item.element);
                }
            });
            items = [];
            
            // æ¸…ç©ºè½¨è¿¹
            trails.forEach(trail => {
                if (trail.element && trail.element.parentNode) {
                    trail.element.parentNode.removeChild(trail.element);
                }
            });
            trails = [];
            
            // æ¸…ç©ºåˆ‡å‰²çº¿
            cutLines.forEach(line => {
                if (line.element && line.element.parentNode) {
                    line.element.parentNode.removeChild(line.element);
                }
            });
            cutLines = [];
            
            // æ›´æ–°UI
            updateUI();
            timeBar.style.width = '100%';
            
            // åˆ›å»ºèƒŒæ™¯å…ƒç´ 
            createBackgroundElements();
            
            // éšè—æ¸¸æˆç»“æŸå¼¹çª—
            gameOverlay.classList.remove('active');
            
            // æ›´æ–°éš¾åº¦æ˜¾ç¤º
            updateDifficulty();
            
            // éšè—è¿å‡»æ˜¾ç¤º
            comboDisplay.classList.remove('active');
        }
        
        // å¼€å§‹æ¸¸æˆå€’è®¡æ—¶
        function startGameWithCountdown() {
            if (gameActive) return;
            
            // éšè—ç§»åŠ¨ç«¯æç¤º
            mobileHint.classList.remove('show');
            
            countdownEl.classList.add('active');
            startBtn.disabled = true;
            
            let countdown = 3;
            countdownEl.textContent = countdown;
            
            const countdownInterval = setInterval(() => {
                countdown--;
                if (countdown > 0) {
                    countdownEl.textContent = countdown;
                } else {
                    countdownEl.textContent = "å¼€å§‹!";
                    setTimeout(() => {
                        countdownEl.classList.remove('active');
                        startGame();
                        clearInterval(countdownInterval);
                    }, 500);
                }
            }, 1000);
        }
        
        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            if (gameActive) return;
            
            gameActive = true;
            startBtn.disabled = true;
            startBtn.innerHTML = '<i class="fas fa-play-circle"></i> æ¸¸æˆä¸­';
            
            // å¼€å§‹æ¸¸æˆè®¡æ—¶å™¨
            gameTimer = setInterval(() => {
                gameTime--;
                timerEl.textContent = gameTime;
                
                // æ›´æ–°è¿›åº¦æ¡
                const progressPercent = (gameTime / totalTime) * 100;
                timeBar.style.width = `${progressPercent}%`;
                
                // æ›´æ–°éš¾åº¦
                if (gameTime <= 20 && gameTime > 10 && difficulty < 2) {
                    difficulty = 2;
                    updateDifficulty();
                } else if (gameTime <= 10 && difficulty < 3) {
                    difficulty = 3;
                    updateDifficulty();
                }
                
                // æ¸¸æˆç»“æŸ
                if (gameTime <= 0) {
                    endGame();
                }
            }, 1000);
            
            // å¼€å§‹ç”Ÿæˆç‰©å“
            itemSpawnTimer = setInterval(spawnItem, 700 - (difficulty * 150));
            
            // å¼€å§‹è½¨è¿¹æ•ˆæœ
            trailTimer = setInterval(updateTrails, 30);
            
            // å¼€å§‹åˆ‡å‰²çº¿æ•ˆæœ
            cutLineTimer = setInterval(updateCutLines, 30);
            
            // æŠ˜å æ§åˆ¶é¢æ¿ï¼ˆç§»åŠ¨ç«¯ï¼‰
            if (isMobile) {
                container.classList.add('controls-collapsed');
            }
        }
        
        // æš‚åœæ¸¸æˆ
        function pauseGame() {
            if (!gameActive) return;
            
            gameActive = false;
            startBtn.disabled = false;
            startBtn.innerHTML = '<i class="fas fa-play-circle"></i> ç»§ç»­';
            
            clearInterval(gameTimer);
            clearInterval(itemSpawnTimer);
            clearInterval(trailTimer);
            clearInterval(cutLineTimer);
        }
        
        // ç”Ÿæˆæ¸¸æˆç‰©å“
        function spawnItem() {
            if (!gameActive) return;
            
            const itemData = gameItems[Math.floor(Math.random() * gameItems.length)];
            
            // åˆ›å»ºç‰©å“å…ƒç´ 
            const item = document.createElement('div');
            item.className = 'game-item';
            
            // è®¾ç½®æ ·å¼
            item.style.background = itemData.bgColor;
            item.style.borderColor = itemData.borderColor;
            
            // æ ¹æ®è®¾å¤‡è°ƒæ•´ç‰©å“å¤§å°
            let itemSize = isMobile ? adjustItemSizeForMobile() : 120;
            if (isMobile && window.innerHeight < 600) {
                itemSize = 85;
            }
            
            item.style.width = `${itemSize}px`;
            item.style.height = `${itemSize}px`;
            
            // éšæœºä½ç½®ï¼ˆä»åº•éƒ¨å‡ºç°ï¼‰
            const x = Math.random() * (gameArea.offsetWidth - itemSize);
            const y = gameArea.offsetHeight + itemSize;
            
            item.style.left = `${x}px`;
            item.style.top = `${y}px`;
            
            // è°ƒæ•´å›¾æ ‡å¤§å°
            const emojiSize = itemSize * 0.5;
            
            // æ·»åŠ å†…å®¹
            item.innerHTML = `
                <div class="item-icon" style="font-size: ${emojiSize}px; line-height: ${itemSize * 0.7}px">${itemData.emoji}</div>
                <div class="item-label">${itemData.name}</div>
            `;
            
            gameArea.appendChild(item);
            
            // è®¡ç®—é€Ÿåº¦ï¼ˆåŸºäºéš¾åº¦ï¼‰
            const speed = itemData.speed + (difficulty * 0.5);
            
            // æ·»åŠ åˆ°ç‰©å“æ•°ç»„
            const itemObj = {
                element: item,
                x: x,
                y: y,
                speed: speed,
                data: itemData,
                width: itemSize,
                height: itemSize,
                isCut: false
            };
            
            items.push(itemObj);
            
            // å¼€å§‹ç‰©å“åŠ¨ç”»
            animateItem(itemObj);
        }
        
        // åŠ¨ç”»ç‰©å“ç§»åŠ¨
        function animateItem(item) {
            if (!gameActive) return;
            
            const moveItem = () => {
                if (!item.element || !item.element.parentNode) return;
                
                // å¦‚æœç‰©å“å·²è¢«åˆ‡å‰²ï¼Œåœæ­¢åŠ¨ç”»
                if (item.isCut) return;
                
                // æ›´æ–°ä½ç½®
                item.y -= item.speed;
                item.element.style.top = `${item.y}px`;
                
                // è½»å¾®å·¦å³æ‘†åŠ¨
                item.x += Math.sin(Date.now() / 500 + item.y / 100) * 0.5;
                item.element.style.left = `${item.x}px`;
                
                // å¦‚æœç‰©å“ç§»å‡ºå±å¹•ï¼Œç§»é™¤å®ƒ
                if (item.y < -200) {
                    // ç§»é™¤ç‰©å“
                    if (item.element.parentNode) {
                        item.element.parentNode.removeChild(item.element);
                    }
                    
                    // ä»æ•°ç»„ä¸­ç§»é™¤
                    const index = items.indexOf(item);
                    if (index > -1) {
                        items.splice(index, 1);
                    }
                    
                    // ä¸­æ–­è¿å‡»
                    if (currentCombo > 0) {
                        currentCombo = 0;
                        updateUI();
                        comboDisplay.classList.remove('active');
                    }
                    
                    return;
                }
                
                // ç»§ç»­åŠ¨ç”»
                requestAnimationFrame(moveItem);
            };
            
            moveItem();
        }
        
        // åˆ‡å‰²ç‰©å“ - å®ç°ä¸€åˆ‡ä¸¤åŠæ•ˆæœ
        function cutItem(item, cutAngle, x, y) {
            if (!item.element || !item.element.parentNode || item.isCut) return;
            
            // æ ‡è®°ç‰©å“å·²è¢«åˆ‡å‰²
            item.isCut = true;
            
            // å¢åŠ åˆ†æ•°
            const comboMultiplier = 1 + (currentCombo * 0.25);
            const itemScore = Math.round(item.data.score * comboMultiplier);
            gameScore += itemScore;
            cutCount++;
            
            // å¢åŠ è¿å‡»
            const now = Date.now();
            if (now - lastCutTime < 1200) { // 1.2ç§’å†…åˆ‡å‰²ç®—è¿å‡»
                currentCombo++;
                if (currentCombo > maxCombo) {
                    maxCombo = currentCombo;
                }
                
                // æ˜¾ç¤ºè¿å‡»æ•ˆæœï¼ˆåªåœ¨è¿å‡»æ•°>1æ—¶æ˜¾ç¤ºï¼‰
                if (currentCombo > 1) {
                    comboCountEl.textContent = currentCombo;
                    comboDisplay.classList.add('active');
                }
                
                // é‡ç½®è¿å‡»è®¡æ—¶å™¨
                clearTimeout(comboTimeout);
                comboTimeout = setTimeout(() => {
                    currentCombo = 0;
                    updateUI();
                    comboDisplay.classList.remove('active');
                }, 1200);
            } else {
                currentCombo = 1;
                // ç¬¬ä¸€æ¬¡åˆ‡å‰²ä¸æ˜¾ç¤ºè¿å‡»
                comboDisplay.classList.remove('active');
                
                // é‡ç½®è¿å‡»è®¡æ—¶å™¨
                clearTimeout(comboTimeout);
                comboTimeout = setTimeout(() => {
                    currentCombo = 0;
                    updateUI();
                    comboDisplay.classList.remove('active');
                }, 1200);
            }
            
            lastCutTime = now;
            
            // æ˜¾ç¤ºåˆ†æ•°å¼¹çª—
            showScorePopup(x, y, itemScore);
            
            // åˆ›å»ºæœæ±å–·æº…æ•ˆæœ
            createJuiceSplash(x, y, item.data.juiceColor);
            
            // æ’­æ”¾åˆ‡å‰²éŸ³æ•ˆï¼ˆæ¨¡æ‹Ÿï¼‰
            playCutSound();
            
            // åˆ›å»ºä¸¤åŠæ•ˆæœ
            createItemHalves(item, cutAngle);
            
            // ç§»é™¤åŸç‰©å“
            if (item.element.parentNode) {
                item.element.parentNode.removeChild(item.element);
            }
            
            // ä»æ•°ç»„ä¸­ç§»é™¤
            const index = items.indexOf(item);
            if (index > -1) {
                items.splice(index, 1);
            }
            
            // æ›´æ–°UI
            updateUI();
        }
        
        // åˆ›å»ºç‰©å“çš„ä¸¤åŠ
        function createItemHalves(item, cutAngle) {
            const centerX = item.x + item.width / 2;
            const centerY = item.y + item.height / 2;
            
            // å·¦åŠéƒ¨åˆ†
            const halfLeft = document.createElement('div');
            halfLeft.className = 'item-half half-left';
            halfLeft.style.background = item.data.bgColor;
            halfLeft.style.borderColor = item.data.borderColor;
            halfLeft.style.width = `${item.width}px`;
            halfLeft.style.height = `${item.height}px`;
            halfLeft.style.left = `${item.x}px`;
            halfLeft.style.top = `${item.y}px`;
            
            // å³åŠéƒ¨åˆ†
            const halfRight = document.createElement('div');
            halfRight.className = 'item-half half-right';
            halfRight.style.background = item.data.bgColor;
            halfRight.style.borderColor = item.data.borderColor;
            halfRight.style.width = `${item.width}px`;
            halfRight.style.height = `${item.height}px`;
            halfRight.style.left = `${item.x}px`;
            halfRight.style.top = `${item.y}px`;
            
            // æ·»åŠ å†…å®¹
            const leftContent = document.createElement('div');
            leftContent.className = 'half-content';
            leftContent.style.width = `${item.width * 2}px`;
            leftContent.style.height = `${item.height}px`;
            leftContent.style.left = '0px';
            
            const emojiSize = item.width * 0.5;
            
            leftContent.innerHTML = `
                <div class="half-emoji" style="font-size: ${emojiSize}px">${item.data.emoji}</div>
                <div class="half-label">${item.data.name}</div>
            `;
            
            const rightContent = document.createElement('div');
            rightContent.className = 'half-content';
            rightContent.style.width = `${item.width * 2}px`;
            rightContent.style.height = `${item.height}px`;
            rightContent.style.left = `-${item.width}px`;
            rightContent.innerHTML = `
                <div class="half-emoji" style="font-size: ${emojiSize}px">${item.data.emoji}</div>
                <div class="half-label">${item.data.name}</div>
            `;
            
            halfLeft.appendChild(leftContent);
            halfRight.appendChild(rightContent);
            
            gameArea.appendChild(halfLeft);
            gameArea.appendChild(halfRight);
            
            // è®¡ç®—æ—‹è½¬å’Œé£å‡ºçš„è§’åº¦
            // åˆ‡å‰²è§’åº¦å†³å®šä¸¤åŠé£å‡ºçš„æ–¹å‘
            const leftRotate = cutAngle - 30 + Math.random() * 20;
            const rightRotate = cutAngle + 30 + Math.random() * 20;
            
            const leftX = Math.cos(leftRotate * Math.PI / 180) * 3;
            const leftY = -Math.abs(Math.sin(leftRotate * Math.PI / 180) * 5) - 3;
            
            const rightX = Math.cos(rightRotate * Math.PI / 180) * 3;
            const rightY = -Math.abs(Math.sin(rightRotate * Math.PI / 180) * 5) - 3;
            
            // åº”ç”¨åŠ¨ç”»
            let leftPosX = item.x;
            let leftPosY = item.y;
            let rightPosX = item.x;
            let rightPosY = item.y;
            let leftRotation = 0;
            let rightRotation = 0;
            let opacity = 1;
            
            const animateHalves = () => {
                // æ›´æ–°ä½ç½®
                leftPosX += leftX;
                leftPosY += leftY;
                rightPosX += rightX;
                rightPosY += rightY;
                
                // æ›´æ–°æ—‹è½¬
                leftRotation += 5;
                rightRotation -= 5;
                
                // æ›´æ–°é€æ˜åº¦
                opacity -= 0.02;
                
                // åº”ç”¨å˜æ¢
                halfLeft.style.left = `${leftPosX}px`;
                halfLeft.style.top = `${leftPosY}px`;
                halfLeft.style.transform = `rotate(${leftRotation}deg)`;
                halfLeft.style.opacity = opacity;
                
                halfRight.style.left = `${rightPosX}px`;
                halfRight.style.top = `${rightPosY}px`;
                halfRight.style.transform = `rotate(${rightRotation}deg)`;
                halfRight.style.opacity = opacity;
                
                // å¦‚æœè¿˜æœ‰é€æ˜åº¦ï¼Œç»§ç»­åŠ¨ç”»
                if (opacity > 0) {
                    requestAnimationFrame(animateHalves);
                } else {
                    // ç§»é™¤å…ƒç´ 
                    if (halfLeft.parentNode) halfLeft.parentNode.removeChild(halfLeft);
                    if (halfRight.parentNode) halfRight.parentNode.removeChild(halfRight);
                }
            };
            
            requestAnimationFrame(animateHalves);
        }
        
        // åˆ›å»ºæœæ±å–·æº…æ•ˆæœ
        function createJuiceSplash(x, y, color) {
            for (let i = 0; i < 12; i++) {
                const particle = document.createElement('div');
                particle.className = 'juice-particle';
                particle.style.left = `${x}px`;
                particle.style.top = `${y}px`;
                particle.style.background = color;
                
                gameArea.appendChild(particle);
                
                // éšæœºæ–¹å‘
                const angle = Math.random() * Math.PI * 2;
                const speed = 1 + Math.random() * 4;
                const vx = Math.cos(angle) * speed;
                const vy = Math.sin(angle) * speed;
                
                // éšæœºå¤§å°
                const size = 4 + Math.random() * 10;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                
                // åŠ¨ç”»ç²’å­
                let posX = x;
                let posY = y;
                let opacity = 0.8;
                
                const animateParticle = () => {
                    posX += vx;
                    posY += vy;
                    opacity -= 0.03;
                    
                    particle.style.left = `${posX}px`;
                    particle.style.top = `${posY}px`;
                    particle.style.opacity = opacity;
                    
                    // é‡åŠ›æ•ˆæœ
                    vy += 0.1;
                    
                    if (opacity > 0) {
                        requestAnimationFrame(animateParticle);
                    } else {
                        if (particle.parentNode) {
                            particle.parentNode.removeChild(particle);
                        }
                    }
                };
                
                requestAnimationFrame(animateParticle);
            }
        }
        
        // æ˜¾ç¤ºåˆ†æ•°å¼¹çª—
        function showScorePopup(x, y, score) {
            const popup = document.createElement('div');
            popup.className = 'score-popup';
            popup.textContent = `+${score}`;
            popup.style.left = `${x}px`;
            popup.style.top = `${y}px`;
            
            gameArea.appendChild(popup);
            
            // åŠ¨ç”»ç»“æŸåç§»é™¤
            setTimeout(() => {
                if (popup.parentNode) {
                    popup.parentNode.removeChild(popup);
                }
            }, 1200);
        }
        
        // åˆ›å»ºåˆ‡å‰²çº¿
        function createCutLine(startX, startY, endX, endY) {
            const line = document.createElement('div');
            line.className = 'cut-line';
            
            // è®¡ç®—çº¿çš„é•¿åº¦å’Œè§’åº¦
            const dx = endX - startX;
            const dy = endY - startY;
            const length = Math.sqrt(dx * dx + dy * dy);
            const angle = Math.atan2(dy, dx) * 180 / Math.PI;
            
            line.style.width = `${length}px`;
            line.style.left = `${startX}px`;
            line.style.top = `${startY}px`;
            line.style.transform = `rotate(${angle}deg)`;
            
            gameArea.appendChild(line);
            
            cutLines.push({
                element: line,
                opacity: 1
            });
        }
        
        // æ›´æ–°åˆ‡å‰²çº¿
        function updateCutLines() {
            // ç§»é™¤æ—§åˆ‡å‰²çº¿
            cutLines.forEach((line, index) => {
                line.opacity -= 0.05;
                line.element.style.opacity = line.opacity;
                
                if (line.opacity <= 0) {
                    if (line.element.parentNode) {
                        line.element.parentNode.removeChild(line.element);
                    }
                    cutLines.splice(index, 1);
                }
            });
        }
        
        // æ’­æ”¾åˆ‡å‰²éŸ³æ•ˆï¼ˆæ¨¡æ‹Ÿï¼‰
        function playCutSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(400 + Math.random() * 300, audioContext.currentTime);
                gainNode.gain.setValueAtTime(0.08, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.15);
            } catch (e) {
                // å¦‚æœéŸ³é¢‘ä¸Šä¸‹æ–‡ä¸å¯ç”¨ï¼Œé™é»˜å¤±è´¥
            }
        }
        
        // æ›´æ–°UI
        function updateUI() {
            scoreEl.textContent = gameScore;
            timerEl.textContent = gameTime;
            comboEl.textContent = currentCombo;
            cutsEl.textContent = cutCount;
        }
        
        // æ›´æ–°éš¾åº¦æ˜¾ç¤º
        function updateDifficulty() {
            let difficultyText = "æ™®é€š";
            if (difficulty === 2) {
                difficultyText = "å›°éš¾";
            } else if (difficulty === 3) {
                difficultyText = "ä¸“å®¶";
            }
            
            difficultyEl.textContent = `éš¾åº¦: ${difficultyText}`;
        }
        
        // ç»“æŸæ¸¸æˆ
        function endGame() {
            gameActive = false;
            
            // æ¸…é™¤æ‰€æœ‰è®¡æ—¶å™¨
            clearInterval(gameTimer);
            clearInterval(itemSpawnTimer);
            clearInterval(trailTimer);
            clearInterval(cutLineTimer);
            clearTimeout(comboTimeout);
            
            // æ¸…ç©ºç‰©å“
            items.forEach(item => {
                if (item.element && item.element.parentNode) {
                    item.element.parentNode.removeChild(item.element);
                }
            });
            items = [];
            
            // æ¸…ç©ºè½¨è¿¹
            trails.forEach(trail => {
                if (trail.element && trail.element.parentNode) {
                    trail.element.parentNode.removeChild(trail.element);
                }
            });
            trails = [];
            
            // æ¸…ç©ºåˆ‡å‰²çº¿
            cutLines.forEach(line => {
                if (line.element && line.element.parentNode) {
                    line.element.parentNode.removeChild(line.element);
                }
            });
            cutLines = [];
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            startBtn.disabled = false;
            startBtn.innerHTML = '<i class="fas fa-play-circle"></i> å¼€å§‹';
            
            // æ˜¾ç¤ºæ¸¸æˆç»“æŸå¼¹çª—
            finalScoreEl.textContent = gameScore;
            finalCutsEl.textContent = cutCount;
            finalComboEl.textContent = maxCombo;
            finalTimeEl.textContent = gameTime > 0 ? `${gameTime}s` : "0s";
            stressReleasedEl.textContent = cutCount;
            
            // æ ¹æ®åˆ†æ•°æ˜¾ç¤ºä¸åŒç»“æœ
            let resultText = "å‡å‹å®Œæˆ!";
            if (gameScore >= 5000) {
                resultText = "å‡å‹å¤§å¸ˆ!";
            } else if (gameScore >= 3000) {
                resultText = "å‹åŠ›å…‹æ˜Ÿ!";
            } else if (gameScore >= 1500) {
                resultText = "å‡å‹é«˜æ‰‹!";
            } else if (gameScore < 500) {
                resultText = "è¿˜éœ€åŠªåŠ›!";
            }
            
            document.getElementById('game-result').textContent = resultText;
            
            // æ˜¾ç¤ºå¼¹çª—
            setTimeout(() => {
                gameOverlay.classList.add('active');
            }, 800);
        }
        
        // è½¨è¿¹æ•ˆæœ
        function updateTrails() {
            // ç§»é™¤æ—§è½¨è¿¹
            trails.forEach((trail, index) => {
                trail.opacity -= 0.06;
                trail.element.style.opacity = trail.opacity;
                trail.element.style.transform = `translate(-50%, -50%) scale(${trail.opacity})`;
                
                if (trail.opacity <= 0) {
                    if (trail.element.parentNode) {
                        trail.element.parentNode.removeChild(trail.element);
                    }
                    trails.splice(index, 1);
                }
            });
        }
        
        // åˆ›å»ºè½¨è¿¹ç‚¹
        function createTrail(x, y) {
            const trail = document.createElement('div');
            trail.className = 'trail';
            trail.style.left = `${x}px`;
            trail.style.top = `${y}px`;
            
            gameArea.appendChild(trail);
            
            trails.push({
                element: trail,
                opacity: 0.9
            });
        }
        
        // é¼ æ ‡/è§¦æ‘¸ç§»åŠ¨å¤„ç†
        function handleMove(x, y) {
            if (!gameActive) return;
            
            // åˆ›å»ºè½¨è¿¹ç‚¹
            createTrail(x, y);
            
            // å¦‚æœæœ‰ä¸Šä¸€ä¸ªç‚¹ï¼Œåˆ›å»ºåˆ‡å‰²çº¿
            if (lastCutPoint) {
                const distance = Math.sqrt(
                    Math.pow(x - lastCutPoint.x, 2) + 
                    Math.pow(y - lastCutPoint.y, 2)
                );
                
                // å¦‚æœè·ç¦»è¶³å¤Ÿï¼Œåˆ›å»ºåˆ‡å‰²çº¿
                if (distance > 15) {
                    createCutLine(lastCutPoint.x, lastCutPoint.y, x, y);
                    
                    // æ£€æµ‹åˆ‡å‰²çº¿æ˜¯å¦ä¸ç‰©å“ç›¸äº¤
                    detectCutIntersection(lastCutPoint.x, lastCutPoint.y, x, y);
                }
            }
            
            // æ›´æ–°ä¸Šä¸€ä¸ªç‚¹
            lastCutPoint = { x, y };
            
            // ç›´æ¥æ£€æµ‹é¼ æ ‡å½“å‰ä½ç½®æ˜¯å¦ä¸ç‰©å“ç›¸äº¤ï¼ˆä½œä¸ºå¤‡ç”¨æ£€æµ‹ï¼‰
            detectDirectIntersection(x, y);
        }
        
        // æ£€æµ‹åˆ‡å‰²çº¿ä¸ç‰©å“çš„äº¤ç‚¹
        function detectCutIntersection(x1, y1, x2, y2) {
            items.forEach(item => {
                if (item.isCut) return;
                
                // è®¡ç®—ç‰©å“ä¸­å¿ƒç‚¹
                const centerX = item.x + item.width / 2;
                const centerY = item.y + item.height / 2;
                const radius = item.width / 2;
                
                // è®¡ç®—åˆ‡å‰²çº¿ä¸åœ†å¿ƒä¹‹é—´çš„æœ€çŸ­è·ç¦»
                const distance = pointToLineDistance(centerX, centerY, x1, y1, x2, y2);
                
                // å¦‚æœè·ç¦»å°äºåŠå¾„ï¼Œè¯´æ˜åˆ‡å‰²çº¿ä¸ç‰©å“ç›¸äº¤
                if (distance < radius) {
                    // è®¡ç®—åˆ‡å‰²è§’åº¦ï¼ˆä»x1,y1åˆ°x2,y2çš„è§’åº¦ï¼‰
                    const cutAngle = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;
                    
                    // è®¡ç®—äº¤ç‚¹ï¼ˆè¿‘ä¼¼ä½¿ç”¨çº¿æ®µä¸­ç‚¹ï¼‰
                    const intersectX = (x1 + x2) / 2;
                    const intersectY = (y1 + y2) / 2;
                    
                    cutItem(item, cutAngle, intersectX, intersectY);
                }
            });
        }
        
        // è®¡ç®—ç‚¹åˆ°çº¿æ®µçš„è·ç¦»
        function pointToLineDistance(px, py, x1, y1, x2, y2) {
            const A = px - x1;
            const B = py - y1;
            const C = x2 - x1;
            const D = y2 - y1;
            
            const dot = A * C + B * D;
            const lenSq = C * C + D * D;
            let param = -1;
            
            if (lenSq !== 0) {
                param = dot / lenSq;
            }
            
            let xx, yy;
            
            if (param < 0) {
                xx = x1;
                yy = y1;
            } else if (param > 1) {
                xx = x2;
                yy = y2;
            } else {
                xx = x1 + param * C;
                yy = y1 + param * D;
            }
            
            const dx = px - xx;
            const dy = py - yy;
            
            return Math.sqrt(dx * dx + dy * dy);
        }
        
        // ç›´æ¥æ£€æµ‹é¼ æ ‡/è§¦æ‘¸ç‚¹æ˜¯å¦ä¸ç‰©å“ç›¸äº¤ï¼ˆå¤‡ç”¨æ£€æµ‹ï¼‰
        function detectDirectIntersection(x, y) {
            items.forEach(item => {
                if (item.isCut) return;
                
                // è®¡ç®—ç‰©å“ä¸­å¿ƒç‚¹
                const centerX = item.x + item.width / 2;
                const centerY = item.y + item.height / 2;
                
                // è®¡ç®—è·ç¦»
                const distance = Math.sqrt(
                    Math.pow(x - centerX, 2) + 
                    Math.pow(y - centerY, 2)
                );
                
                // å¦‚æœè·ç¦»å°äºç‰©å“åŠå¾„ï¼Œåˆ™åˆ‡å‰²
                if (distance < item.width / 2) {
                    // éšæœºåˆ‡å‰²è§’åº¦
                    const cutAngle = Math.random() * 360;
                    cutItem(item, cutAngle, x, y);
                }
            });
        }
        
        // äº‹ä»¶ç›‘å¬å™¨
        startBtn.addEventListener('click', startGameWithCountdown);
        
        pauseBtn.addEventListener('click', () => {
            if (gameActive) {
                pauseGame();
            } else {
                startGame();
            }
        });
        
        resetBtn.addEventListener('click', () => {
            pauseGame();
            initGame();
        });
        
        playAgainBtn.addEventListener('click', () => {
            initGame();
            startGameWithCountdown();
        });
        
        // æ§åˆ¶é¢æ¿æŠ˜å /å±•å¼€
        controlsToggle.addEventListener('click', () => {
            container.classList.toggle('controls-collapsed');
        });
        
        // å…³é—­ç§»åŠ¨ç«¯æç¤º
        closeHintBtn.addEventListener('click', () => {
            mobileHint.classList.remove('show');
            startGameWithCountdown();
        });
        
        // é¼ æ ‡äº‹ä»¶
        gameArea.addEventListener('mousemove', (e) => {
            const rect = gameArea.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            handleMove(x, y);
        });
        
        // è§¦æ‘¸äº‹ä»¶ï¼ˆç§»åŠ¨è®¾å¤‡ï¼‰
        gameArea.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const rect = gameArea.getBoundingClientRect();
            const touch = e.touches[0];
            const x = touch.clientX - rect.left;
            const y = touch.clientY - rect.top;
            
            handleMove(x, y);
        }, { passive: false });
        
        gameArea.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const rect = gameArea.getBoundingClientRect();
            const touch = e.touches[0];
            const x = touch.clientX - rect.left;
            const y = touch.clientY - rect.top;
            
            // åˆå§‹åŒ–ä¸Šä¸€ä¸ªç‚¹
            lastCutPoint = { x, y };
            
            handleMove(x, y);
            
            // å±•å¼€æ§åˆ¶é¢æ¿
            if (isMobile && container.classList.contains('controls-collapsed')) {
                container.classList.remove('controls-collapsed');
            }
        }, { passive: false });
        
        // é¼ æ ‡/è§¦æ‘¸ç»“æŸï¼Œé‡ç½®ä¸Šä¸€ä¸ªç‚¹
        gameArea.addEventListener('mouseup', () => {
            lastCutPoint = null;
        });
        
        gameArea.addEventListener('touchend', () => {
            lastCutPoint = null;
        });
        
        // åˆå§‹åŒ–ç§»åŠ¨ç«¯è®¾ç½®
        initMobileSettings();
        
        // åˆå§‹åŒ–æ¸¸æˆ
        initGame();
        
        // æ·»åŠ é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                e.preventDefault();
                if (gameActive) {
                    pauseGame();
                } else {
                    startGameWithCountdown();
                }
            } else if (e.code === 'KeyR') {
                e.preventDefault();
                pauseGame();
                initGame();
            } else if (e.code === 'Escape') {
                e.preventDefault();
                if (gameActive) {
                    pauseGame();
                }
            }
        });
        
        // çª—å£å¤§å°å˜åŒ–æ—¶é‡æ–°è°ƒæ•´
        window.addEventListener('resize', () => {
            initMobileSettings();
        });
    </script>
</body>
</html>
